<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <title>Produkte hinzufügen TuningHub</title>
    <link rel="stylesheet" href="/src/css/main.css" />
    <link rel="stylesheet" href="/src/css/teilehinzufügen.css" />
    <link rel="stylesheet" href="/src/css/menu.css" />
    <link rel="stylesheet" href="/src/css/search.css" />
    <script type="module" src="/src/js/supabaseClient.js"></script>
    <script src="/src/js/menu.js"></script>
    <script src="/src/js/search.js"></script>
    <script type="module" src="/src/js/produkteHinzufügen.js"></script>
    <style>
      /* Styling für Bild-Upload und Vorschau */
      .image-upload-container {
        margin-bottom: 15px;
      }

      .image-preview-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
      }

      .image-preview {
        position: relative;
        width: 100px;
        height: 100px;
        border: 1px solid #ddd;
        border-radius: 4px;
        overflow: hidden;
      }

      .image-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .remove-image {
        position: absolute;
        top: 0;
        right: 0;
        background: rgba(255, 0, 0, 0.7);
        color: white;
        border: none;
        width: 24px;
        height: 24px;
        border-radius: 0 0 0 4px;
        cursor: pointer;
        font-size: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .add-image-btn {
        background-color: #f0f0f0;
        color: #333;
        border: 1px dashed #ccc;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 10px;
        display: inline-block;
      }

      .add-image-btn:hover {
        background-color: #e0e0e0;
      }

      .image-input-wrapper {
        margin-bottom: 10px;
      }

      /* Styling für Lade-Overlay */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        display: none;
      }

      .loading-overlay.show {
        display: flex;
      }

      /* Kategorie-Styling */
      .category-container {
        margin-bottom: 15px;
      }

      .category-selection {
        margin-bottom: 10px;
      }

      .new-category-container {
        display: none;
        margin-top: 10px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background-color: #f9f9f9;
      }

      .new-category-buttons {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      .cancel-category-btn {
        background-color: #6c757d;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }

      .cancel-category-btn:hover {
        background-color: #545b62;
      }

      .create-category-btn {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        margin-top: 5px;
      }

      .create-category-btn:hover {
        background-color: #0056b3;
      }

      .category-option {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
      }

      .category-option input[type="radio"] {
        margin-right: 8px;
      }

      .categories-list {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 8px;
        background-color: white;
      }

      /* Styling für Link-Input */
      .link-container {
        margin-bottom: 15px;
      }

      .link-help-text {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
        font-style: italic;
      }

      /* Success und Error Messages */
      .success-message {
        background-color: #d4edda;
        color: #155724;
        padding: 12px;
        border: 1px solid #c3e6cb;
        border-radius: 4px;
        margin-bottom: 15px;
        display: none;
      }

      .error-message {
        background-color: #f8d7da;
        color: #721c24;
        padding: 12px;
        border: 1px solid #f5c6cb;
        border-radius: 4px;
        margin-bottom: 15px;
        display: none;
      }
    </style>
  </head>

  <body>
    <div class="loading-overlay" id="loadingOverlay">
      <div>Wird verarbeitet...</div>
    </div>

    <header class="header">
      <div class="header-top">
        <div class="logo">
          <a href="../index.html">
            <img
              src="../../../TuningHub/public/img/THub-Logo-ohne-Hintergrund-500x200.png"
              alt="TuningHub Logo"
              height="50"
            />
          </a>
        </div>
        <div class="searchbar-wrapper">
          <input
            id="searchbar"
            type="text"
            class="searchbar"
            placeholder="Suche nach Teilen, Marken..."
          >
          <img 
            src="../../../TuningHub/public/svg/search_60dp_000000_FILL0_wght400_GRAD0_opsz48.../../../TuningHub/public/svg"
          >
        </div>
        
        <button id="menu-btn" class="menu-button" aria-controls="sidebar" aria-expanded="false" aria-label="Navigation öffnen">
          <!-- Öffnen -->
          <img src="../../../TuningHub/public/svg/menu_60dp_000000_FILL0_wght400_GRAD0_opsz48.../../../TuningHub/public/svg" alt="Menu" width="36" height="36" class="icon icon-open">
          <!-- Schließen -->
          <img src="../../../TuningHub/public/svg/close_60dp_000000_FILL0_wght400_GRAD0_opsz48.../../../TuningHub/public/svg" alt="Schließen" width="36" height="36" class="icon icon-close">
        </button>
        
        <nav class="sidebar" id="sidebar">
          <div class="sidebar-header">
            <div class="sidebar-title">Navigation</div>
          </div>
          <div class="menu-items">
            <!-- Menu items werden von menu.js geladen -->
          </div>
        </nav>
        <div class="overlay" id="overlay"></div>
      </div>
    </header>

    <main>
      <section id="teile-hinzufuegen">
        <h2>Teil hinzufügen</h2>

        <div id="success-message" class="success-message"></div>
        <div id="error-message" class="error-message"></div>

        <label for="partTitle">Titel *</label>
        <input 
          type="text" 
          id="partTitle" 
          placeholder="z. B. Auspuff S51" 
          required 
          maxlength="100" 
        />

        <label for="partDescription">Beschreibung *</label>
        <textarea 
          id="partDescription" 
          placeholder="Beschreibe das Teil..." 
          rows="4" 
          required 
          maxlength="1000"
        ></textarea>

        <label for="partPrice">Preis (in €) *</label>
        <input 
          type="number" 
          id="partPrice" 
          placeholder="z. B. 49.99" 
          step="0.01" 
          min="0" 
          max="99999" 
          required 
        />

        <!-- Link-Eingabefeld -->
        <div class="link-container">
          <label for="sellerLink">Link zum Produkt auf eurer Webseite *</label>
          <input 
            type="url" 
            id="sellerLink" 
            required 
            placeholder="z. B. https://meinshop.de/mein-produkt" 
            maxlength="500" 
          />
        
        </div>

        <!-- Hidden field für Zustand - automatisch auf "neu" gesetzt -->
        <input type="hidden" value="neu" id="partCondition" required />

        <!-- Kategorie-Auswahl -->
        <div class="category-container">
          <label>Kategorie *</label>
          
          <div class="category-selection">
            <select id="categorySelect" required>
              <option value="">Kategorie wird geladen...</option>
            </select>
            <div id="categoryError" class="category-error"></div>
          </div>

          <!-- Button für neue Kategorie -->
          <button type="button" id="showNewCategoryBtn" class="create-category-btn">
            Neue Kategorie erstellen
          </button>

          <!-- Bereich für neue Kategorie (initial ausgeblendet) -->
          <div class="new-category-container" id="newCategoryContainer" style="display: none;">
            <label for="newCategoryName">Name der neuen Kategorie *</label>
            <input 
              type="text" 
              id="newCategoryName" 
              placeholder="z. B. Auspuffanlagen" 
              maxlength="100" 
            />
            
            <label for="newCategoryDescription">Beschreibung (optional)</label>
            <textarea 
              id="newCategoryDescription" 
              placeholder="Beschreibe die neue Kategorie..." 
              rows="2" 
              maxlength="500"
            ></textarea>
            
            <div class="new-category-buttons">
              <button type="button" id="createCategoryBtn" class="create-category-btn">
                Kategorie erstellen
              </button>
              <button type="button" id="cancelNewCategoryBtn" class="cancel-category-btn">
                Abbrechen
              </button>
            </div>
          </div>
        </div>

        <!-- Bild-Upload -->
        <div class="image-upload-container">
          <label>Bilder auswählen (max. 5) *</label>
          <div id="imageInputsContainer">
            <div class="image-input-wrapper">
              <input 
                type="file" 
                class="partImage" 
                accept="image/jpeg,image/jpg,image/png,image/gif,image/webp" 
                data-index="0" 
                required 
              />
            </div>
          </div>

          <div id="imagePreviews" class="image-preview-container"></div>

          <button type="button" id="addImageBtn" class="add-image-btn">
            Weiteres Bild hinzufügen
          </button>
        </div>

        <!-- Hidden fields -->
        <input type="hidden" id="partType" value="teil" />
        <input type="hidden" id="selectedCategoryId" value="" />

        <button id="addPartBtn" type="button">Teil hinzufügen</button>
      </section>
    </main>

    <footer>
      <div class="informations"><a href="uebertuninghub.html">TuningHub</a></div>
      <div class="informations"><a href="impressum.html">Impressum</a></div>
      <div class="informations"><a href="support.html">Support</a></div>
      <div class="informations"><a href="socialmedia.html">Social Media</a></div>
      <div class="informations"><a href="agb.html">AGB</a></div>
      <div class="informations"><a href="haftungsbeschränkung.html">Haftungsbeschränkung</a></div>
      <div class="informations"><a href="datenschutz.html">Datenschutz</a></div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  </body>
</src/pages>